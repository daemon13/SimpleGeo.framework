# !/bin/bash

VERSION=$1
DEBUG=$2

if [ -z "$VERSION" ]
then
  echo "Please specify a version"
  exit 1
fi

echo "Using ${VERSION} for building..."

TOP_DIR=`pwd`

TMP_IOS_FILE=/tmp/SimpleGeo-$VERSION.tgz
TMP_MAC_FILE=/tmp/SimpleGeo-iOS-$VERSION.tgz
TMP_DOC_FILE=/tmp/SimpleGeo-$VERSION-docset.tgz

cd Project/Mac
make
cd build/Release
tar zcf $TMP_MAC_FILE SimpleGeo.framework
cd $TOP_DIR

cd Project/iOS
make dist
mv SimpleGeo-iOS.tgz $TMP_IOS_FILE
cd $TOP_DIR

cd Documentation
make
cd html
tar zcf $TM_DOC_FILE
cd $TOP_DIR

git checkout gh-pages
mkdir $VERSION
cp -R Documentation/html/* $VERSION/
git add $VERSION/
git commit -m "Docs for ${VERSION}"

git checkout framework
rm -rf *
tar zxf $TMP_MAC_FILE
mv SimpleGeo.framework/* .
rmdir SimpleGeo.framework

git add *

git commit -am "Version $VERSION"
git tag $VERSION-framework

git checkout framework-ios
rm -rf *
tar zxf $TMP_IOS_FILE
mv SimpleGeo.framework/* .
rmdir SimpleGeo.framework

git commit -am "Version $VERSION"
git tag $VERSION-framework-ios

git checkout master
git push
git push --tags

mv $TMP_IOS_FILE $TMP_DOC_FILE $TMP_MAC_FILE .
